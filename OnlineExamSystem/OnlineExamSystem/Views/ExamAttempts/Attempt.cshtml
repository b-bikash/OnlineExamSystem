@model OnlineExamSystem.Models.ExamAttemptViewModel

@{
    ViewData["Title"] = "Exam Attempt";
    Layout = "_Layout";
}

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f6f8;
    }

    .exam-header {
        background-color: #1e3a8a;
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .student-info {
        background-color: #e5e7eb;
        padding: 10px 20px;
        font-weight: bold;
    }

    .exam-container {
        display: flex;
        padding: 20px;
    }

    .question-nav {
        width: 20%;
        background-color: white;
        padding: 15px;
        border-radius: 5px;
        margin-right: 20px;
    }

    /* üîπ Anchor styled as button (Option 1 ‚Äì recommended) */
    .nav-btn {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        width: 45px;
        height: 45px;
        margin: 5px;
        border-radius: 5px;
        background-color: #d1d5db;
        color: black;
        text-decoration: none;
        font-weight: bold;
        cursor: pointer;
    }

    .question-area {
        width: 80%;
        background-color: white;
        padding: 20px;
        border-radius: 5px;
    }

    .options label {
        display: block;
        margin: 10px 0;
        cursor: pointer;
    }

    .actions {
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    /* üîπ Shared button-link style */
    .btn-link {
        padding: 10px 20px;
        border-radius: 5px;
        color: white;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }

    .previous {
        background-color: #6b7280;
    }

    .save {
        background-color: #2563eb;
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
    }

    .submit {
        background-color: #dc2626;
        margin-top: 20px;
        float: right;
        padding: 10px 25px;
        border-radius: 5px;
        color: white;
        border: none;
        cursor: pointer;
    }
</style>

<div class="exam-header">
    <div>üìò @Model.ExamTitle</div>
    <div>‚è± Duration: @Model.DurationInMinutes minutes</div>
    <div>Logout üîí</div>
</div>

<div class="student-info">
    Attempt ID: @Model.AttemptId
</div>

<div class="exam-container">

    <!-- QUESTION NAVIGATION -->
    <div class="question-nav">
        <h4>Questions</h4>

        @for (int i = 0; i < Model.Questions.Count; i++)
        {
            <!-- ‚úÖ Anchor styled as button (NO nested button) -->
            <a asp-action="Attempt"
               asp-route-attemptId="@Model.AttemptId"
               asp-route-questionIndex="@i"
               class="nav-btn">
                @(i + 1)
            </a>
        }
    </div>

    <!-- QUESTION AREA -->
    <div class="question-area">
        <h3>Question @(Model.CurrentQuestionIndex + 1)</h3>

        <p>@Model.Question.Text</p>

        <!-- SAVE ANSWER FORM -->
        <form asp-action="SaveAnswer" method="post">
            <input type="hidden" name="attemptId" value="@Model.AttemptId" />
            <input type="hidden" name="questionId" value="@Model.Question.Id" />
            <input type="hidden" name="questionIndex" value="@Model.CurrentQuestionIndex" />

            <div class="options">
                @foreach (var option in Model.Options)
                {
                    <label>
                        <input type="radio"
                               name="selectedOptionId"
                               value="@option.Id"
                               @(Model.SelectedOptionId == option.Id ? "checked" : "") />
                        @option.Text
                    </label>
                }
            </div>

            <div class="actions">
                @if (Model.CurrentQuestionIndex > 0)
                {
                    <!-- ‚úÖ Previous navigation as anchor -->
                    <a asp-action="Attempt"
                       asp-route-attemptId="@Model.AttemptId"
                       asp-route-questionIndex="@(Model.CurrentQuestionIndex - 1)"
                       class="btn-link previous">
                        Previous
                    </a>
                }

                <!-- Save button stays a real submit button -->
                <button type="submit" class="save">Save</button>

                @if (Model.CurrentQuestionIndex < Model.TotalQuestions - 1)
                {
                    <!-- ‚úÖ Next navigation as anchor -->
                    <a asp-action="Attempt"
                       asp-route-attemptId="@Model.AttemptId"
                       asp-route-questionIndex="@(Model.CurrentQuestionIndex + 1)"
                       class="btn-link save">
                        Next
                    </a>
                }
            </div>
        </form>

        <!-- SUBMIT EXAM -->
        <form method="post"
              action="/ExamAttempts/Submit"
              onsubmit="return confirmSubmit();">

            @Html.AntiForgeryToken()

            <input type="hidden" name="attemptId" value="@Model.AttemptId" />

            <button type="submit" class="submit">
                Submit Exam
            </button>
        </form>

    </div>
</div>

<script>
    function confirmSubmit() {
        const totalQuestions = @Model.TotalQuestions;
        const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;

        if (answeredQuestions < totalQuestions) {
            return confirm(
                "You have not answered all the questions.\n\nAre you sure you want to submit?"
            );
        }

        return true;
    }
</script>

@*@<script>
    function submitExam() {
        const selectedOption = document.querySelector('input[name="selectedOptionId"]:checked');

        if (selectedOption) {
            // Auto-save current answer first
            const form = document.querySelector('form[action*="SaveAnswer"]');
            form.submit();
            return;
        }

        // If no option selected
        if (!confirm("You have not answered all the questions.\n\nAre you sure you want to submit?")) {
            return;
        }

        document.querySelector('form[action*="Submit"]').submit();
    }
</script>*@
