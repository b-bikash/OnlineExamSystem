@model OnlineExamSystem.Models.QuestionEditViewModel

@{
    ViewData["Title"] = "Edit Question";
    Layout = "_Layout";

    // Ensure exactly 4 option slots for UI
    var optionSlots = new List<OnlineExamSystem.Models.OptionEditItemViewModel>();
    optionSlots.AddRange(Model.Options);

    while (optionSlots.Count < 4)
    {
        optionSlots.Add(new OnlineExamSystem.Models.OptionEditItemViewModel
        {
            OptionId = 0,
            Text = string.Empty
        });
    }
}

<h2>Edit Question</h2>

<form asp-action="Edit" method="post">
    @Html.AntiForgeryToken()

    <!-- Hidden identifiers -->
    <input type="hidden" asp-for="QuestionId" />
    <input type="hidden" asp-for="ExamId" />

    <!-- Question Text -->
    <div class="form-group">
        <label asp-for="QuestionText">Question</label>
        <textarea asp-for="QuestionText" class="form-control" rows="3"></textarea>
        <span asp-validation-for="QuestionText" class="text-danger"></span>
    </div>

    <!-- Marks -->
    <div class="form-group mt-3">
        <label>Marks</label>
        <input type="number"
               name="Marks"
               class="form-control"
               min="0"
               value="@Model.Marks"
               required />
        <small class="text-muted">
            Enter marks for this question (0 or more).
        </small>
    </div>

    <hr />

    <h4>Options</h4>
    <p class="text-muted">
        Edit options (2–4 allowed). You may add new options if fewer than 4 exist.
    </p>

    @for (int i = 0; i < optionSlots.Count; i++)
    {
        <div class="form-group">
            <!-- OptionId (0 means new option) -->
            <input type="hidden"
                   name="Options[@i].OptionId"
                   value="@optionSlots[i].OptionId" />

            <div class="form-check">
                <input class="form-check-input"
                       type="radio"
                       name="CorrectOptionId"
                       value="@optionSlots[i].OptionId"
                       @(optionSlots[i].OptionId == Model.CorrectOptionId && optionSlots[i].OptionId != 0
                                          ? "checked"
                                          : "") />
                <label class="form-check-label">
                    Correct
                </label>
            </div>

            <input class="form-control"
                   name="Options[@i].Text"
                   value="@optionSlots[i].Text"
                   placeholder="Option @(i + 1)" />
        </div>
    }

    <!-- Validation summary -->
    <div class="text-danger">
        @Html.ValidationSummary(false)
    </div>

    <br />

    <button type="submit" class="btn btn-success">Save Changes</button>
    <a asp-action="Index"
       asp-route-examId="@Model.ExamId"
       class="btn btn-secondary">
        Cancel
    </a>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
